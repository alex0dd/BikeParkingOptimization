<html>
    <head>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
            integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
            crossorigin=""/>
        <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
            integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
            crossorigin=""></script>
        <script src="./js/CoordinateProvider.js"></script>
        <script src="./js/LocationMap.js"></script>
    </head>
    <style>
    #mapid { height: 720px; }
    </style>
    <body>
        <div id="mapid"></div>
        <div id="debug"></div>
        <script>
            const RandomNumber = (minimum, maximum) => Math.floor(Math.random() * (maximum - minimum + 1)) + minimum;
            const boundX = 30;
            const boundY = 30;
            var initialLocation = [44.484443, 11.325102];//[44.49381, 11.33875]; // Bologna is latitude=44.49381, longitude=11.33875
            var squareLength = 100; // 100 meters
            var coordProvider = new CoordinateProvider(initialLocation, squareLength);
            var locationMap = new LocationMap({x: boundX, y: boundY});
            
            // Generate random population data
            for(var i = 0; i < boundY; i++) for(var j = 0; j < boundX; j++) locationMap.setPopulationAt(i, j, RandomNumber(0, 100));

            /*
            Debug
            */
            var debugDiv = document.getElementById('debug');
            //debugDiv.innerText = "Loading data";
            /*
            Map related
            */
            // preferCanvas makes all points render in a canvas, avoiding to create a DOM element for each point, making the rendering faster
            var map = L.map('mapid', {preferCanvas: true}).setView(initialLocation, 18);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom: 18}).addTo(map);

                        
             map.on('click', function(e) {
                debugDiv.innerText = "Clicked on: "+e.latlng.lat+", "+e.latlng.lng;
            });
            
            /*
            pseudocode:
            for i=0 to n row
                for j=0 to n column
                    renderRect([i, j], [i+1, j+1])
            */
            for(var i = 0; i < boundY; i++){
                for(var j = 0; j < boundX; j++){
                    var population = locationMap.getPopulationAt(i, j);
                    var colorWeight = (population/locationMap.getHighestPopulation())*0.9;
                    L.rectangle([coordProvider.elementAt(i, j), coordProvider.elementAt(i+1,j+1)],{
                        color: "#00000f", 
                        weight: 1.0, 
                        fillColor: "green", 
                        fillOpacity: colorWeight
                    }).bindPopup(locationMap.getPopulationAt(i, j)+"").addTo(map);
                }
            }
        </script>
    </body>
</html>